# =============================================================================
# My second App - Example Application Deployment
# =============================================================================
# This file will be discovered by the "general" ApplicationSet and
# automatically create an ArgoCD Application that deploys example-app
# to the "default" namespace.
#
# Path breakdown:
#   values/dev/general/default/example-app/my-second-app.yaml
#          â”‚    â”‚       â”‚       â”‚           â””â”€â”€ Release name
#          â”‚    â”‚       â”‚       â””â”€â”€ Chart name (matches helm-charts/example-app)
#          â”‚    â”‚       â””â”€â”€ Target namespace
#          â”‚    â””â”€â”€ ApplicationSet name (must be enabled in appsets.yaml)
#          â””â”€â”€ Cluster name
# =============================================================================

# Override deployment settings
deployments:
  - name: example-app-second
    namespace: default
    replicas: 2
    containers:
      - name: nginx
        image:
          registry: docker.io
          repository: nginx
          tag: alpine
        imagePullPolicy: IfNotPresent
        ports:
          - name: http
            containerPort: 80
            protocol: TCP
        resources:
          requests:
            cpu: 10m
            memory: 32Mi
          limits:
            cpu: 100m
            memory: 128Mi
        livenessProbe:
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 5
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /
            port: http
          initialDelaySeconds: 5
          periodSeconds: 10
        volumeMounts:
          - name: html-config
            mountPath: /usr/share/nginx/html/index.html
            subPath: index.html
    volumes:
      - name: html-config
        configMap:
          name: example-app-second-html

# Service configuration
services:
  - name: example-app-second
    namespace: default
    type: ClusterIP
    ports:
      - name: http
        port: 80
        targetPort: 80
        protocol: TCP

# ConfigMap with custom message
configmaps:
  - name: example-app-second-html
    namespace: default
    file_content:
      index.html: |
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>My Second App</title>
            <style>
                body {
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    height: 100vh;
                    margin: 0;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                }
                .container {
                    text-align: center;
                    padding: 2rem;
                    background: rgba(255,255,255,0.1);
                    border-radius: 16px;
                    backdrop-filter: blur(10px);
                }
                h1 { margin-bottom: 0.5rem; }
                p { opacity: 0.9; }
                .info { font-size: 0.85rem; opacity: 0.7; margin-top: 1rem; }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>ðŸŽ‰ Welcome to My Second App!</h1>
                <p>Successfully deployed via ArgoCD GitOps</p>
                <div class="info">
                    Cluster: dev | Namespace: default
                </div>
            </div>
        </body>
        </html>

# =============================================================================
# ArgoCD Application Overrides (Optional)
# =============================================================================
application:
  metadata:
    annotations:
      description: "My Second test application deployed via ArgoCD"
